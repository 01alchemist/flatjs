// Simple lock.
//
// Note, this is not currently legal since structs can't carry methods.

@flatjs struct Lock {
    // Clearly "private" is desirable
    lock: synchronic int32

    @method init(SELF) {
	SELF.lock = 0;
	return SELF;
    }

    @method acquire(SELF) {
	while (SELF.compareExchange_lock(0, 1) != 0)
	    SELF.expectUpdate_lock(1, Number.POSITIVE_INFINITY);
    }

    @method release(SELF) {
	SELF.lock = 0;
    }
} @end
